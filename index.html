<!DOCTYPE html>
<html>
<head>
  <meta charset='utf-8'>

  <title>arlobelshee/GildedRose @ GitHub</title>

  <style type="text/css">
    body {
	  margin-top: 1.0em;
	  background-color: #FFFFFF;
	  font-family: Helvetica, Arial, FreeSans, san-serif;
	  color: #000000;
  }
    #container {
      margin: 0 auto;
      width: 700px;
    }
    h1 {
	  font-size: 3.8em;
	  color: #800000;
	  margin-bottom: 3px;
  }
    h1 .small { font-size: 0.4em; }
    h1 a { text-decoration: none }
    h2 { font-size: 1.5em; color: #800000; }
    dt { font-weight:bold; margin-top:0.4em; }
    dd { margin-left: 1.8em; }
    .attribution {
	 margin-left:2.5em;
	 margin-top:0em;
	 font-style:italic;
}
    h3 { text-align: center; color: #800000; }
    a {
	  color: #800000;
  }
    .description { font-size: 1.2em; margin-bottom: 30px; margin-top: 30px; font-style: italic;}
    .download { float: right; }
    pre { background: #000; color: #fff; padding: 15px;}
    hr { border: 0; width: 80%; border-bottom: 1px solid #aaa}
    .footer { text-align:center; padding-top:30px; font-style: italic; }
  </style>
</head>

<body>
  <a href="https://github.com/arlobelshee/GildedRose"><img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub" /></a>

  <div id="container">

    <div class="download">
      <a href="https://github.com/arlobelshee/GildedRose/zipball/master">
        <img border="0" width="90" src="https://github.com/images/modules/download/zip.png"></a>
      <a href="https://github.com/arlobelshee/GildedRose/tarball/master">
        <img border="0" width="90" src="https://github.com/images/modules/download/tar.png"></a>
    </div>

    <h1><a href="https://github.com/arlobelshee/GildedRose">GildedRose</a></h1>
    <h2 class="attribution">by <a href="https://github.com/arlobelshee">arlobelshee</a></h2>

    <div class="description">
      A Kata to practice your refactoring.
    </div>

<p>In this kata, you will add one new piece of functionality to an existing indebted code base. The problem description is available in the comment block at the top of the main class file. I will also repeat it below.</p>

<p>The intention is to get your feet wet with refactoring indebted code. Additionally, see if you can identify what makes this code hard to work with, both in particular example and in terms of the anti-patterns present within it.</p>

<p>This is a simple example of some indebted code. It is only about 30 lines long, yet it feels like nasty legacy. It gets to several of the core anti-patterns that cause debt in real systems:</p>

<dl>
<dt>Primitive Obsession</dt>
<dd>In this case, the Item class is an Anemic Domain Model Object. It doesn't have any members, and you aren't allowed to put any onto it.</dd>
<dt>Operating by side effect</dt>
<dd>The UpdateQuality method gets its values by direct access to a variable outside its scope (a member variable, in this case), and then makes its changes by setting values by side effect. It neither takes nor returns any values.</dd>
<dt>Insufficient tests</dt>
<dd>There is one test, and it always passes. It used to also be poorly named, but I found that people then never renamed it to something useful. This way, I'm hoping that people will at least use good names for subsequent tests.</dd>
</dl>

<p>The code is also legacy code (code that has business value, so is risky to screw up). It has the following common characteristics of legacy code:</p>

<dl>
<dt>High business value</dt>
<dd>This is the core algorithm for the inventory processing system, and includes all the business logic rules for managing the inventory.</dd>
<dt>It works</dt>
<dd>You are being asked to add a new feature. However, before you start, the code is a bug-free, correct implementation of all previously existing features.</dd>
</dl>

<h2>Problem Statement</h2>

<p>There is an existing inventoy processing function, named <code>UpdateQuality()</code>. It does nearly everything that we need. We are running an inn, and this function updates the quality level and sell by date for all the items in our inventory.</p>

<p>Different items have different business rules. The current code handles the business rules correctly for all items. These business rules can be found in comments in the code.</p>

<p>We need to add a new type of item. Again, details for the new rule are in comments in the code.</p>

<p>The project is already late, so "just make the minimal changes to fix the bug." Of course, you should also leave the code better than it was before you started. This is, after all, the most important code "asset" that this company owns.</p>

<p>Finally, there are some office politics going on. There is a set of code that you can't change (to see why, read the code comments). If you change even a single character of the file HereBeDragons.cs, then you will be fired.</p>

<h2>Sample Solutions</h2>

<p>In each of these sample solutions I attempted to commit each separate thought or move as a seperate change. I also put in long commit messages. My intent is that you can read my git history to see what I was thinking each step on the way.</p>

<dl>
<dt>Empty starting point</dt>
<dd>
The <a href="https://github.com/arlobelshee/GildedRose">master</a> branch contains an empty starting point. I have hooked up a few testing libs that I find useful on legacy code.
</dd>
<dt>Easy starting point</dt>
<dd>
The <a href="https://github.com/arlobelshee/GildedRose/commits/start_with_pinning_test">start_with_pinning_tests</a> branch contains a slightly easier starting point. It includes a pinning test. This is an ugly, legacy test that covers all the existing functionality. It verifies the code's current behavior. Note, however, that this test, like most integration tests, overspecifies. For example, it ensures that the code does the wrong thing when given a Conjured item. Still, this is a good place to start from if you aren't used to writing your own pinning tests.
</dd>
<dt>Whole hog refactoring, procedural style</dt>
<dd>
In <a href="https://github.com/arlobelshee/GildedRose/commits/arlo_procedural_refactor_first">arlo_procedural_refactor_first</a>, I followed my nose but did a whole lot of refactoring before adding the new feature. The result is a highly testable implementation. However, it took a while to do and resulted in many changes to the code. This is not necessarily optimal when working with legacy. I did, at least, stop myself before refactoring this into some OO monster. It doesn't need to go OO in order to handle current needs (in fact, OO makes some things more complicated). So I kept it procedural&mdash;just high-quality procedural. This is a pretty good example of listening to the code and letting it lead me to a pretty good design.
</dd>
<dt>Restraining myself</dt>
<dd>
With <a href="https://github.com/arlobelshee/GildedRose/commits/arlo_quick_in_and_out">arlo_quick_in_and_out</a> I was attempting to work like I would on a legacy code save project. I need to minimize my time spent on this one improvement, because I need to make small improvements all over the code base. I don't want to invest too deeply in one area. I would rather get to know the whole system and make it all a little more malleable. That will enable the bigger changes that are likely coming. Also this reduces the chance of introducing new bugs. So this attempt tries to make the code just a little more testable (and tested), implement the new requirement, and then move on without spending too much time. It was marginally successful; I made a few more refactorings than I should have before implementing the new feature.
</dd>
</dl>

      <h2>License</h2>
      <p>MIT</p>
    
      <h2>Authors</h2>
      <p><a href="https://github.com/arlobelshee">Arlo Belshee</a><br/>
      Bobby Johnson (bobby.johnson@gmail.com)<br/>
      Ian Davis (ian@innovatian.com)</p>

    <h2>Download</h2>
    <p>
      You can download this project in either
      <a href="https://github.com/arlobelshee/GildedRose/zipball/master">zip</a> or
      <a href="https://github.com/arlobelshee/GildedRose/tarball/master">tar</a> formats.
    </p>
    <p>You can also clone the project with <a href="http://git-scm.com">Git</a>
      by running:
      <pre>$ git clone git://github.com/arlobelshee/GildedRose</pre>
    </p>

    <div class="footer">
      get the source code on GitHub : <a href="https://github.com/arlobelshee/GildedRose">arlobelshee/GildedRose</a>
    </div>

  </div>

</body>
</html>
